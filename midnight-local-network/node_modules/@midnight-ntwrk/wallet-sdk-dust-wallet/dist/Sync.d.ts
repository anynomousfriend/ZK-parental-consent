import { Effect, Layer, Schema, Scope, Stream } from 'effect';
import { DustSecretKey, Event as LedgerEvent, LedgerParameters } from '@midnight-ntwrk/ledger-v7';
import { SubscriptionClient, QueryClient } from '@midnight-ntwrk/wallet-sdk-indexer-client/effect';
import { WalletError } from '@midnight-ntwrk/wallet-sdk-shielded/v1';
import { Simulator, SimulatorState } from './Simulator.js';
import { DustCoreWallet } from './DustCoreWallet.js';
import { NetworkId } from './types/ledger.js';
export interface SyncService<TState, TStartAux, TUpdate> {
    updates: (state: TState, auxData: TStartAux) => Stream.Stream<TUpdate, WalletError.WalletError, Scope.Scope>;
    blockData: () => Effect.Effect<BlockData, WalletError.WalletError>;
}
export interface BlockData {
    hash: string;
    height: number;
    ledgerParameters: LedgerParameters;
    timestamp: Date;
}
export interface SyncCapability<TState, TUpdate> {
    applyUpdate: (state: TState, update: TUpdate) => TState;
}
export type IndexerClientConnection = {
    indexerHttpUrl: string;
    indexerWsUrl?: string;
};
export type DefaultSyncConfiguration = {
    indexerClientConnection: IndexerClientConnection;
    networkId: NetworkId;
};
export type SimulatorSyncConfiguration = {
    simulator: Simulator;
    networkId: NetworkId;
};
export type SimulatorSyncUpdate = {
    update: SimulatorState;
    secretKey: DustSecretKey;
};
type SecretKeysResource = <A>(cb: (key: DustSecretKey) => A) => A;
export declare const SecretKeysResource: {
    create: (secretKey: DustSecretKey) => SecretKeysResource;
};
export declare const SyncEventsUpdateSchema: Schema.Struct<{
    id: typeof Schema.Number;
    raw: Schema.Schema<LedgerEvent, string, never>;
    maxId: typeof Schema.Number;
}>;
export type WalletSyncSubscription = Schema.Schema.Type<typeof SyncEventsUpdateSchema>;
export type WalletSyncUpdate = {
    updates: WalletSyncSubscription[];
    secretKeys: SecretKeysResource;
    timestamp: Date;
};
export declare const WalletSyncUpdate: {
    create: (updates: WalletSyncSubscription[], secretKey: DustSecretKey, timestamp: Date) => WalletSyncUpdate;
};
export declare const makeDefaultSyncService: (config: DefaultSyncConfiguration) => SyncService<DustCoreWallet, DustSecretKey, WalletSyncUpdate>;
export type IndexerSyncService = {
    connectionLayer: () => Layer.Layer<SubscriptionClient, WalletError.WalletError, Scope.Scope>;
    subscribeWallet: (state: DustCoreWallet) => Stream.Stream<WalletSyncSubscription, WalletError.WalletError, Scope.Scope | SubscriptionClient>;
    queryClient: () => Layer.Layer<QueryClient, WalletError.WalletError, Scope.Scope>;
};
export declare const makeIndexerSyncService: (config: DefaultSyncConfiguration) => IndexerSyncService;
export declare const makeDefaultSyncCapability: () => SyncCapability<DustCoreWallet, WalletSyncUpdate>;
export declare const makeSimulatorSyncService: (config: SimulatorSyncConfiguration) => SyncService<DustCoreWallet, DustSecretKey, SimulatorSyncUpdate>;
export declare const makeSimulatorSyncCapability: () => SyncCapability<DustCoreWallet, SimulatorSyncUpdate>;
export {};
