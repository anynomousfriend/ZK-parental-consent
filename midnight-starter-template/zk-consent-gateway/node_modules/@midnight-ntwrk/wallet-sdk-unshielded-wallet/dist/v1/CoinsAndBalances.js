import { pipe } from 'effect';
import { RecordOps } from '@midnight-ntwrk/wallet-sdk-utilities';
import { UnshieldedState } from './UnshieldedState.js';
const calculateBalances = (utxos) => utxos.reduce((acc, { utxo }) => ({
    ...acc,
    [utxo.type]: acc[utxo.type] === undefined ? utxo.value : acc[utxo.type] + utxo.value,
}), {});
export const makeDefaultCoinsAndBalancesCapability = () => {
    const getAvailableBalances = (state) => {
        const availableCoins = getAvailableCoins(state);
        return calculateBalances(availableCoins);
    };
    const getPendingBalances = (state) => {
        const pendingCoins = getPendingCoins(state);
        return calculateBalances(pendingCoins);
    };
    const getTotalBalances = (state) => {
        const availableBalances = getAvailableBalances(state);
        const pendingBalances = getPendingBalances(state);
        return pipe([availableBalances, pendingBalances], RecordOps.mergeWithAccumulator(0n, (a, b) => a + b));
    };
    const getAvailableCoins = (state) => UnshieldedState.toArrays(state.state).availableUtxos;
    const getPendingCoins = (state) => UnshieldedState.toArrays(state.state).pendingUtxos;
    const getTotalCoins = (state) => [
        ...getAvailableCoins(state),
        ...getPendingCoins(state),
    ];
    return {
        getAvailableBalances,
        getPendingBalances,
        getTotalBalances,
        getAvailableCoins,
        getPendingCoins,
        getTotalCoins,
    };
};
